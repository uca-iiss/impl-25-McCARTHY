pipeline {
    agent {
        docker {
            image 'scala-herencia:dev'
            args '-v $PWD:/app -w /app'
        }
    }

    stages {
        stage('Compilar') {
            steps {
                sh 'sbt compile'
            }
        }

        stage('Test') {
            steps {
                sh 'sbt test'
                script {
                    if (fileExists('target/test-reports')) {
                        junit 'target/test-reports/*.xml'
                    } else {
                        echo 'No se encontr贸 el directorio target/test-reports, omitiendo publicaci贸n de resultados.'
                    }
                }
            }
        }
        
        stage('Empaquetar') {
            steps {
                sh 'sbt package'
                script {
                    if (fileExists('target/scala-2.13')) {
                        sh 'ls -lh target/scala-2.13'
                    } else {
                        echo 'No se gener贸 el jar. target/scala-2.13 no existe.'
                    }
                }
            }
        }
    }

    post {
        always {
            echo 'Pipeline finalizado.'
        }
        failure {
            echo 'El pipeline fall贸. Revisa los logs anteriores.'
        }
    }
}

